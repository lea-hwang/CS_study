# Vue Lifecycle

Vue 컴포넌트 인스턴스가 생성될 때, 일련의 초기화 단계를 거친다. 예를 들어, 데이터 감시를 설정하거나, 템플릿을 컴파일하고, 인스턴스를 DOM에 마운트하고, 데이터가 변경되면 DOM을 업데이트 해야한다.

그 과정에서 생명 주기 훅(`lifecycle hooks`)이라 불리는 함수도 실행하여, 특정 단계에서 개발자가 의도하는 로직이 실행될 수 있도록 한다.



### Lifecycle Diagram

<img src="https://ko.vuejs.org/assets/lifecycle.d3fe54ca.png" alt="Component lifecycle diagram" style="zoom: 33%;" />



## Options API

#### 생명주기 훅 등록하기

```javascript
export default {
  mounted() {
    console.log(`컴포넌트가 마운트 됐습니다.`)
  }
}
```

생명주기의 원하는 한 시점에 특정 이벤트를 발생시키고 싶을 때 위와 같이 작성한다. 가장 일반적으로 사용되는 것은, `mounted`, `updated`, `unmounted`가 있다. 

> ❗**주의 사항**
>
> 모든 생명주기 훅은 호출하는 현재 활성 인스턴스를 가리키는 `this` 컨텍스트로 호출하기 때문에 화살표 함수를 사용해서는 안된다.

#### 생명주기 훅 살펴보기

- `beforeCreate`

  : 인스턴스가 초기화 된 다음 *props가 처리된 후*, *`data()` 또는 `computed`와 같은 다른 옵션을 처리하기 전*에 호출된다.

▶️ **옵션 API 초기화**

- `created`

  : 인스턴스가 모든 상태 관리 옵션 처리(`data()`, `computed`, `methods`, `watch` 등)를 완료한 후 호출된다. (option API 초기화 후 단계)

  > ❗그러나 아직 마운팅 단계(실제 DOM 생성 단계)가 시작되지 않았으므로, `$el` 속성을 사용할 수 없다.

▶️ **템플릿을 렌더함수로 컴파일**

- `beforeMount`

  : 컴포넌트가 마운트되기 직전 호출한다. 반응형 상태 설정이 완료된 후, DOM 노드가 생성되지 않았으며 첫 DOM 렌더 이펙트를 실행한다. (템플릿을 렌더함수로 컴파일 후 단계)

  > ❗서버 사이드 렌더링 중에 호출되지 않는다.

▶️ **초기 렌더링: DOM 노드 생성 및 삽입**

- `mounted`

  : 컴포넌트가 마운트 된 후 호출된다.

  > 컴포넌트가 마운트된 것으로 간주되는 경우:
  >
  > - 동기적으로 선언된 모든 자식 컴포넌트가 마운트됨(비동기 컴포넌트 또는 `<Suspense>` 트리 내부 컴포넌트는 포함하지 않음)
  > - 자체 DOM 트리가 생성되어 상위 컨테이너에 삽입된 경우. 앱의 루트 컨테이너가 문서 내에 있고, 컴포넌트의 DOM 트리도 문서 내 있는 경우에만 보장됨.

  > ❗서버사이드 렌더링 중에 호출되지 않는다.

- `beforeUpdate`

  반응형 상태 변경에 의한 컴포넌트 DOM 트리 직전에 호출된다. Vue가 DOM을 업데이트하기 전, DOM 상태에 접근할 때 사용한다. 컴포넌트 상태를 수정해도 안전하다.

  ❗서버사이드 렌더링 중에 호출되지 않는다.

▶️ **리렌더링 패치**

- `updated`

  반응형 상태 변경에 의한 컴포넌트 DOM 트리 업데이트 이후 호출된다. 부모의 `updated` 훅은 자식의 `updated` 이후에 호출된다. 한 코드 블럭 내에서 특정 상태 변경 후, 이어서 업데이트된 DOM에 접근하는 로직의 경우, `nextTick()`을 사용해야 한다.

  ❗서버사이드 렌더링 중에 호출되지 않는다.

  ❗`updated` 훅에서 컴포넌트 상태를 변경하면, 무한 업데이트 루프가 발생할 수 있다.

- `beforeUnmount`

  컴포넌트 인스턴스가 마운트 해제되기 직전에 호출된다. 이 훅이 호출된 경우에도 컴포넌트 인스턴스는 여전히 온전히 작동한다.

  ❗서버사이드 렌더링 중에 호출되지 않는다.

- `unmounted`

  컴포넌트가 마운트 해제된 후 호출된다.

  언마운트된 것으로 간주하는 경우,

  - 모든 자식 컴포넌트가 언마운트되거나,
  - 관련된 모든 반응형 이펙트가 중지되었을 때 

  ❗서버사이드 렌더링 중에 호출되지 않는다.

- `errorCaptured`

  자식 컴포넌트에서 전파된 에러가 캡쳐되었을 때 호출된다.

- `activated`

  `KeepAlive`로 캐시된 컴포넌트 인스턴스가 DOM 트리의 일부로 삽입된 후 호출된다.

  ❗서버사이드 렌더링 중에 호출되지 않는다.

- `deactivated`

  `KeepAlive`로 캐시된 컴포넌트 인스턴스가 DOM 트리에서 제거된 후 호출된다.

  ❗서버사이드 렌더링 중에 호출되지 않는다.

- `serverPrefetch`(SSR 전용)

  컴포넌트 인스턴스가 서버에서 렌더링 되기 전에 완료(resolve)되어야 하는 비동기 함수이다.

  ```javascript
  export default {
    data() {
      return {
        data: null
      }
    },
    async serverPrefetch() {
      // 서버에서 미리 데이터를 가져오는 것은
      // 클라이언트에서 데이터를 요청하는 것보다 빠름.
      // 최초 데이터 요청 결과로 컴포넌트의 일부가 렌더링 됨.
      this.data = await fetchOnServer(/* ... */)
    },
    async mounted() {
      if (!this.data) {
        // 마운트 시 데이터가 null일 경우,
        // 컴포넌트가 클라이언트에서 동적으로 렌더링되도록
        // 클라이언트 측에서 가져오기를 실행해야 함.
        this.data = await fetchOnClient(/* ... */)
      }
    }
  }
  ```

  





**참고 자료**

https://ko.vuejs.org/guide/essentials/lifecycle.html